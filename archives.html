<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Archives</title><link rel="stylesheet" href="dark-fix.css"><script defer src="env.js"></script></head><body><div style="max-width:1000px;margin:20px auto"><h2>Archives</h2><div><label>Table <select id="table"><option>trucks</option><option>trailers</option><option>expenses</option><option>repairs</option><option>invoices</option></select></label><button id="refresh">Refresh</button><button id="backup">Create backup now</button><a href="/">← Back</a></div><table border="1" width="100%" style="margin-top:12px"><thead><tr><th>Key</th><th>Timestamp</th><th>Table</th><th>Actions</th></tr></thead><tbody id="rows"><tr><td colspan="4">Loading…</td></tr></tbody></table></div><script>function P(k){var m=/^backup:(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z):tms:(\w+)$/.exec(k);return m?{ts:m[1],table:m[2]}:null}async function L(t){const r=await fetch('/api/backups/'+t,{cache:'no-store'});const j=await r.json();return j.backups||[]}function R(a){const b=document.getElementById('rows');if(!a.length){b.innerHTML='<tr><td colspan=4>No backups</td></tr>';return}b.innerHTML=a.map(k=>{const p=P(k)||{ts:'—',table:'—'};return `<tr><td>${k}</td><td>${p.ts}</td><td>${p.table}</td><td><a href="#" onclick="V('${k}')">View</a> · <a href="#" onclick="D('${k}')">Download</a></td></tr>`}).join('')}async function refresh(){R(await L(document.getElementById('table').value))}async function createB(){await fetch('/api/backup',{method:'POST'});await refresh()}async function V(key){const r=await fetch('/api/backup?key='+encodeURIComponent(key));const tx=await r.text();const w=window.open('','_blank');w.document.write('<pre>'+tx.replace(/[&<>]/g,s=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[s]))+'</pre>');w.document.close()}async function D(key){const r=await fetch('/api/backup?key='+encodeURIComponent(key));const blob=await r.blob();const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=key.replaceAll(':','_')+'.json';a.click();URL.revokeObjectURL(a.href)}document.getElementById('refresh').onclick=refresh;document.getElementById('backup').onclick=createB;refresh();</script></body></html>